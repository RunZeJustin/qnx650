
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta name="copyright" content="(C) Copyright 2005" />
      <meta name="DC.rights.owner" content="(C) Copyright 2005" />
      <meta name="DC.Type" content="concept" />
      <meta name="DC.Title" content="Using Function Instrumentation mode for a single application" />
      <meta name="abstract" content="" />
      <meta name="description" content="" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROUSECASES_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_USEAPPPROFUNCINST_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_FISAMPLMODE_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_FISYSPROF_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFCreateSessFromIDELnch_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFCreateSessByImpData_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFSingleThreadedApp_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFaRunProcess_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFUsingPostmortemProf_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFPsotMortemProfiling_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFRunningFromTermCmdLine_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROFTakeSnapshot_.html" />
      <meta name="DC.Relation" scheme="URI" content="../topic/profiler_PROCompResults_.html" />
      <meta name="DC.Format" content="XHTML" />
      <meta name="DC.Identifier" content="UsingFunctionInstrumentationmodeforasingleapplication" />
      <meta name="DC.Language" content="en-us" />
      <link rel="stylesheet" type="text/css" href="../commonltr.css" />
      <link rel="stylesheet" type="text/css" href="../style.css" />
      <title>Using Function Instrumentation mode for a single application</title>
   </head>
   <body id="UsingFunctionInstrumentationmodeforasingleapplication"><a name="UsingFunctionInstrumentationmodeforasingleapplication" shape="rect">
         <!-- --></a>
      
      
      
      <h1 class="topictitle1">Using Function Instrumentation mode for a single application</h1>
      
      
      
      <div>
         <p></p>
         
         
         <p>This method lets you obtain precise function information at runtime. It performs best for
            one thread because when there is more than one thread, the overhead measurement from
            multiple threads can change the application's behavior. 
         </p>
         
         
         <p>To compile an application with Function Instrumentation: </p>
         
         <br clear="none" /><ol>
            <li>Depending on your type of project, do one of the following: <br clear="none" /><ul>
                  <li>For a QNX C/C++ project: <br clear="none" /><ol type="a">
                        <li>In the Project Explorer view, right-click your project and select
                           <span class="uicontrol">Properties</span>. 
                        </li>
                        <li>In the left pane, select <span class="uicontrol">QNX C/C++ project</span>. 
                        </li>
                        <li>In the right pane, select the <span class="uicontrol">Options</span> tab. 
                        </li>
                        <li>Select <span class="uicontrol">Build for Profiling (Function
                              Instrumentation)</span>. 
                        </li>
                     </ol>
                     
                  </li>
                  <li>For a managed project with a QNX toolchain: <br clear="none" /><ol type="a">
                        <li>Right-click on a project and select
                           <span class="uicontrol">Properties</span>. 
                        </li>
                        <li>From the menu, select <span class="menucascade">
                              <span class="uicontrol">C/C++ Build</span>
                              &gt; <span class="uicontrol">Settings</span>
                              &gt; <span class="uicontrol">Tools settings</span>
                              </span>. 
                        </li>
                        <li>From the list on the right, select <span class="uicontrol">QCC
                              Compiler</span>. 
                        </li>
                        <li>From the list on the right, for your compiler (i.e. <span class="uicontrol">QCC
                              Compiler</span>), select an item from the list and select
                           <span class="uicontrol">Output Control</span>. 
                        </li>
                        <li>Select the <span class="uicontrol">Build for Profiling (Function
                              Instrumentation)</span> option. 
                        </li>
                        <li>From the list on the right for your linker (i.e. QCC Linker), select
                           an item from the list, then select <span class="uicontrol">Output
                              Control</span>. 
                        </li>
                        <li>Select the <span class="uicontrol">Build for Profiling (Function Instrumentation)
                              (<span class="option">-lprofilingS</span>)</span> option. 
                        </li>
                     </ol>
                     
                  </li>
                  <li>For a <span class="filepath">Makefile</span>: <br clear="none" /><ol type="a">
                        <li>To compile the application or library with Function Instrumentation,
                           add the option <span class="option">-finstrument-functions</span>. 
                        </li>
                        <li>For linking, add the option <span class="option">-lprofilingS</span>. 
                        </li>
                     </ol>
                     
                     <div class="note"><span class="notetitle">Note:</span> 
                        
                        <p>For a standard <span class="filepath">Makefile</span> that uses default rules,
                           your file would have the <span class="option">-finstrument-functions</span> and <span class="option">-lprofilingS</span>
                           options for profiling, and it would look similar to this: 
                        </p>
                        
                        <pre class="codeblock" xml:space="preserve">CFLAGS += -g -O0 -finstrument-functions 
LDLIBS += -lprofilingS</pre>
                        
                        <p>If the <span class="filepath">Makefile</span> doesn't use the default linking
                           and compile rules, flags and/or library, for profiling you'll need
                           to manually add the <span class="option">-finstrument-functions</span> and <span class="option">-lprofilingS</span> options
                           as in the following example: 
                        </p>
                        
                        <pre class="codeblock" xml:space="preserve">main.o 
       qcc -g -O0 -finstrument-functions -o main.o main.c
binary: 
       qcc -o binary main.o -lprofilingS</pre>
                        
                        <p>For QNX recursive <span class="filepath">Makefiles</span>, you would also have
                           the <span class="option">-finstrument-functions</span> and <span class="option">profilingS</span> options, and the
                           <span class="filepath">Makefile</span> would look similar to the
                           following: 
                        </p>
                        
                        <pre class="codeblock" xml:space="preserve">CFLAGS += -g -O0 -finstrument-functions 
LIBS += profilingS</pre>
                        
                        <p>The <var class="varname">LIBS</var> variable adds the list of libraries to
                           include into the appropriate compiler options for profiling; you
                           don't use <var class="varname">LDFLAGS</var> or <var class="varname">LDOPTS</var> to
                           add libraries. 
                        </p>
                        
                        
                        <p>Notice that in the examples above, the <span class="option">-l</span> option appears at the end
                           of each statement. This positioning occurs because <span class="cmdname">qcc</span>
                           doesn't understand the <span class="option">-l</span> option before source and objects files; it
                           must appear at the end.   
                        </p>
                        
                        
                     </div>
                     
                  </li>
               </ul>
               
            </li>
            <li>To launch a profiling session: <br clear="none" /><ul>
                  <li>For a single application with Function Instrumentation (your code exists in
                     an IDE project, as well as any binary and library files): <br clear="none" /><ol type="a">
                        <li>Create a new Launch configuration. </li>
                        <li>On the <span class="uicontrol">Tools</span> tab, select
                           <span class="uicontrol">Add/Delete Tool…</span>, select
                           <span class="uicontrol">Application Profiler</span>, and click
                           <span class="uicontrol">OK</span>. 
                        </li>
                        <li>On the <span class="uicontrol">Application Profiler</span> tab, select
                           <span class="uicontrol">Functions Instrumentation</span>. 
                        </li>
                        <li>For the <span class="uicontrol">Profiling Scope</span>, select
                           <span class="uicontrol">Single Application</span>. 
                        </li>
                        <li>Click <span class="uicontrol">Apply</span>, and then click
                           <span class="uicontrol">Run</span>. 
                        </li>
                     </ol>
                     
                     <div class="note"><span class="notetitle">Note:</span> 
                        
                        <p>If the process doesn't finish, you'll have to terminate it manually.
                           Instead of terminating the process, you can terminate the
                           Application Profiler service in the Debug view; the IDE will
                           download the current state of the data. 
                        </p>
                        
                        
                        <p>The Application Profiler isn't optimized for data transfer; each
                           second of application running time can generate up to 2 MB of data.
                           
                        </p>
                        
                        
                     </div>
                     
                  </li>
                  <li>From the command line on target machine: <br clear="none" /><ol type="a">
                        <li>Set <var class="varname">QPROF_FILE</var> environment variable to
                           <span class="filepath">/tmp/profiler.ptrace</span>. 
                        </li>
                        <li>Launch the application, and then stop the application after some
                           time, because the trace can't contain more than several seconds
                           (minutes at most) of data. 
                        </li>
                        <li>In the IDE, copy the file <var class="varname">$QPROF_FILE</var> into the
                           IDE workspace (i.e. into the target project) using Target File
                           System Navigator view. 
                        </li>
                        <li>Switch to the <span class="uicontrol">Application Profiler</span>
                           perspective. 
                        </li>
                        <li>In the Profiler Sessions view, select the <span class="uicontrol">Import
                              Application Profiler Session</span> icon. 
                        </li>
                        <li>Follow the steps in the Import wizard to specify the binary and any
                           Shared Library paths. 
                           <div class="note"><span class="notetitle">Note:</span>  If the binary wasn't compiled on the
                              same host, you'll need to edit the <span class="uicontrol">Source
                                 Path</span> tab to add the source search path or
                              mapping between the compiled code location and the location of
                              the source on the host machine. 
                           </div>
                           
                        </li>
                        <li>Click <span class="uicontrol">Finish</span>. 
                           <p>The IDE creates a profiler
                              session and automatically selects it. 
                           </p>
                           
                        </li>
                     </ol>
                     
                  </li>
               </ul>
               
            </li>
         </ol>
         
         
      </div>
      
      
      <div>
         
         <div class="familylinks">
            
            <div class="parentlink"><strong>Parent topic:</strong> <a href="../topic/profiler_PROUSECASES_.html" shape="rect">Using the Application Profiler</a></div>
            
         </div>
         
         <div class="relinfo"><strong>Related concepts</strong><br clear="none" />
            
            <div><a href="../topic/profiler_USEAPPPROFUNCINST_.html" shape="rect">Using Function Instrumentation with the Application Profiler</a></div>
            
            <div><a href="../topic/profiler_FISAMPLMODE_.html" shape="rect">Using Sampling and Call Count instrumentation mode</a></div>
            
            <div><a href="../topic/profiler_FISYSPROF_.html" shape="rect">Using Function Instrumentation in the System Profiler</a></div>
            
            <div><a href="../topic/profiler_PROCompResults_.html" shape="rect">Comparing profiles</a></div>
            
         </div>
         
         <div class="relinfo"><strong>Related tasks</strong><br clear="none" />
            
            <div><a href="../topic/profiler_PROFCreateSessFromIDELnch_.html" shape="rect">Creating an Application Profiler session</a></div>
            
            <div><a href="../topic/profiler_PROFCreateSessByImpData_.html" shape="rect">Creating a profiler session by importing profiler data</a></div>
            
            <div><a href="../topic/profiler_PROFSingleThreadedApp_.html" shape="rect">Profiling a single-threaded application</a></div>
            
            <div><a href="../topic/profiler_PROFaRunProcess_.html" shape="rect">Profiling a running process for an existing project</a></div>
            
            <div><a href="../topic/profiler_PROFUsingPostmortemProf_.html" shape="rect">Using postmortem profiling for Call Count and Sampling</a></div>
            
            <div><a href="../topic/profiler_PROFPsotMortemProfiling_.html" shape="rect">Postmortem profiling</a></div>
            
            <div><a href="../topic/profiler_PROFRunningFromTermCmdLine_.html" shape="rect">Running an instrumented binary with profiling from a command prompt (Function Instrumentation mode)</a></div>
            
            <div><a href="../topic/profiler_PROFTakeSnapshot_.html" shape="rect">Taking a snapshot of a profiling session</a></div>
            
         </div>
         
      </div>
      
      <div id="custom-footer">
         	
         <p class="copyright-notice"><a href="PLUGINS_ROOT/com.qnx.doc.copyright/topic/copyright_overview.html" style="color:black" shape="rect">Copyright</a> | <a href="http://community.qnx.com/sf/sfmain/do/home" style="color:black" shape="rect">Community</a></p>
         
      </div>
      
   </body>
</html>